<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order - PillPocket</title>
<link rel="stylesheet" href="{{ url_for('static', filename='styles/common.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='styles/header.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='styles/footer.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='styles/order.css') }}">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="logo">
            <h1>PillPocket</h1>
        </div>
        <nav>
            <ul>
                <li><a href="../index.html">Home</a></li>
                <li><a href="medications.html">Medications</a></li>
                <li><a href="order.html" class="active">Order</a></li>
                <li><a href="about.html">About</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <section class="order-hero">
            <h2>Available Medications</h2>
            <p>Select the medications you need and place your order.</p>
        </section>
        <section id="medication-list" class="order-summary">
            <!--- Medication List dynamic-->
        </section>
    </main>
    <footer>
    <p>Â© 2025 PillPocket. All rights reserved.</p>
    </footer>
    <script>
    document.addEventListener("DOMContentLoaded", () => {
        fetch("http://127.0.0.1:5000/api/v1/medication")
        .then(res => res.json())
        .then(meds => {
            const container = document.getElementById("medication-list");
            meds.forEach(med => {
                const medBox = document.createElement("div");
                medBox.className = "order-item";
                medBox.innerHTML = `
                <h3>${med.name}</h3>
                <p><strong>Dosage:</strong> ${med.dosage}</p>
                <p><strong>Price:</strong> $${med.price}</p>
                <p><strong>Stock:</strong> ${med.stock}</p>
                <input type="number" id="qty-${med.id}" min="1" max="${med.stock}" value="1">
                <button onclick="placeOrder('${med.id}', ${med.price})">Order</button>
                <hr/>
            `;
                container.appendChild(medBox);
            });
        });
    });

    function placeOrder(medId, price) {
        const qty = parseInt(document.getElementById(`qty-${medId}`).value);
        const userId = "822daf6a-3915-4068-9e41-9e34d68a6366";
        fetch(fetch("http://127.0.0.1:5001/api/v1/medication"), {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                user_id: userId,
                medication_id: medId,
                quantity: qty
            })
        })
        .then(res => res.json())
        .then(order => {
            alert(`Order placed!\nTotal: $${order.total_price}\nStatus: ${order.status}`);
        })
        .catch(err => {
            console.error("Order failed", err);
            alert("An error occurred. Please try again.");
        });
    }
    </script>
</body>
</html>
