<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order - PillPocket</title>
<link rel="stylesheet" href="{{ url_for('static', filename='styles/common.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='styles/header.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='styles/footer.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='styles/order.css') }}">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="logo">
            <h1>PillPocket</h1>
        </div>
        <nav>
            <ul>
                <li><a href="{{ url_for('home_route') }}">Home</a></li>
                <li><a href="{{ url_for('medications_route') }}">Medications</a></li>
                <li><a href="{{ url_for('order_route') }}" class="active">Order</a></li>
                <li><a href="{{ url_for('about_route') }}">About</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <section class="order-hero">
            <h2>Available Medications</h2>
            <p>Select the medications you need and place your order.</p>
        </section>
        <section id="medication-list" class="order-summary">
            <!--- Medication List dynamic-->
        </section>
    </main>
    <footer>
    <p>Â© 2025 PillPocket. All rights reserved.</p>
    </footer>
    <!-- jQuery CDN -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Link to your JS script (optional) or inline script -->
<script>
  $(document).ready(function () {
    $.get("http://127.0.0.1:5001/api/v1/medication", function (meds) {
      const container = $("#medication-list");
      meds.forEach(function (med) {
        const medBox = `
          <div class="order-item">
            <h3>${med.name}</h3>
            <p><strong>Dosage:</strong> ${med.dosage}</p>
            <p><strong>Price:</strong> $${med.price}</p>
            <p><strong>Stock:</strong> ${med.stock}</p>
            <input type="number" id="qty-${med.id}" min="1" max="${med.stock}" value="1">
            <button onclick="placeOrder('${med.id}', ${med.price})">Order</button>
            <hr/>
          </div>
        `;
        container.append(medBox);
      });
    });
  });

  function placeOrder(medId, price) {
    const qty = parseInt($(`#qty-${medId}`).val());
    const userId = "822daf6a-3915-4068-9e41-9e34d68a6366";

    $.ajax({
      type: "POST",
      url: "http://127.0.0.1:5001/api/v1/medication",
      contentType: "application/json",
      data: JSON.stringify({
        user_id: userId,
        medication_id: medId,
        quantity: qty
      }),
      success: function (order) {
        alert(`Order placed!\nTotal: $${order.total_price}\nStatus: ${order.status}`);
      },
      error: function () {
        alert("Order failed. Please try again.");
      }
    });
  }
</script>
</body>
</html>
